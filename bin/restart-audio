#!/bin/bash

getCoreAudioPid () {
  PID="$(ps -ef | grep coreaudiod | grep -v grep | awk '{print $2}')"
  echo "$PID"
}

restartAudio () {
  OLD_PID="$(getCoreAudioPid)"
  NEW_PID=$OLD_PID
  ATTEMPT=0

  while [ "$NEW_PID" == "$OLD_PID" ]; do
    kill -9 $OLD_PID

    if [ $ATTEMPT -ge "5" ]; then
      echo "Unable to restart core-audio. (You may wish to retry as sudo.)"
      exit 1
    fi

    sleep 1
    ATTEMPT=$((ATTEMPT + 1))
    NEW_PID="$(getCoreAudioPid)"
  done

  echo "Successfully restarted core-audio - Re-crank your volume!! ðŸ”ˆ"
}

restartAudio

